# 직접 도커 이미지를 만들어보기

* 도커 이미지는 컨테이너를 만들기 위해 필요한 설정이나 종속성들을 갖고있는 소프트웨어 패키지
* DockerHub의 다른사람이 만들어 놓은 것을 쓸 수 있고, 직접 만들어서 쓰거나 업로드 가능
* `docker create <이미지이름>`

## 도커 이미지 생성 순서

Dockerfile 작성 -> 도커 클라이언트 -> 도커 서버 -> 이미지 생성



## Dockerfile 만들기

### 도커 파일이란 ? 

* 도커 이미지를 만들기 위한 설정파일
* 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의

### 도커 파일 만드는 순서 ( 뭐가 필요할까 )

1. **베이스 이미지**를 명시해준다 - 파일 스냅샷
   * 베이스 이미지란 ? 
     * 도커 이미지는 여러 개의 레이어로 되어있음
     * 그 중에 기반이 되는 부분 - OS
2. 추가적으로 필요한 파일을 다운 받기 위한 몇가지 명령어를 명시한다. - 파일 스냅샷
3. 컨테이너 시작시 실행 될 명령어를 명시 - 시작시 실행 될 명령어

### 실제로 만들어보기

```
Hello 문구 출력하자 !
```

## 순서

1. 기본적인 토대 명시 

   #### FROM

   이미지 생성시 기반이 되는 이미지 레이어

   <이미지이름>:<태그> 형식으로 작성

   태그를 안붙이면 자동적으로 가장 최신것으로 다운 받음

   ex) ubuntu:14.04

   #### RUN

   도커이미지가 생성되기 전에 수행할 쉘 명령어

   #### CMD

   컨테이너가 시작되었을 때 실행할 파일 또는 쉘 스크립트

   한번만 쓸 수 있음

2. 베이스 이미지 실제값으로 

   * ubuntu / centos 다 되지만 굳이 큰거 할 필요가 없음 alpine으로 

3. echo 써야하는데 이미 alpine안에 echo 명령어 사용 가능 RUN은 생략

## Dockerfile로 이미지 만들기

### build 

* `docker build <path>` 
* 해당 디렉토리 내에서 dockerfile 찾아서 도커 클라이언트에 전달해준다.

### build 과정

* alpine 이미지 가져온다
* 임시 컨테이너 생성 후 그 컨테이너 시작시 사용할 명령어 포함 시킨다
* 임시 컨테이너 지우고 새 이미지가 만들어진다.

### 임시 컨테이너를 왜 만들고 지우는걸까?

![image](https://user-images.githubusercontent.com/72075148/130329288-0a47c072-2131-4a06-b65e-ec0328edf7ee.png)

* 베이스 이미지로 컨테이너 만들고
* 해당 컨테이너에 시작 시 실행 명령어 추가하고
* 그거로 이미지 만들고, 임시 컨테이너 지움



이미지로 컨테이너 만들고 ? 컨테이너로 이미지 만들고 ..



## 빌드한 이미지 사용하기

* 해시값 쓰면 되는데, 이름 줘보자.
* tag 를 주면됨 ( -t )
* `docker build -t <내 도커 아이디>/<저장소/프로젝트이름>:<버전>`