# 9. 복잡한 어플을 실제로 배포해보기(개발 환경 부분)

## 섹션 설명

좀 더 많은 컨테이너를 사용하여 좀 더 실무에서 사용할수 있는 어플리케이션을 만들어보겠습니다.



Nginx를 사용하여 설계하는 방법이 여러 가지가 있습니다.

아래 두 방법 중 더 어려운 위에 방식으로 개발하겠습니다.

![image-20210908000318258](../images/section09/architecture1.png)

### 장점

* Request를 보낼 때 URL host 이름이 바뀌어도 변경시켜주지 않아도 됩니다.
* 포트가 바뀌어도 변경을 안해주어도 됩니다.

### 단점

* nginx 설정, 전체 설계가 다소 복잡합니다.

![image-20210908000337272](../images/section09/architecture2.png)

### 장점

* 설계가 다소 간단하여 구현하는게 더 쉽습니다.

### 단점

* host name이나 포트 변경있을 때 Request URL도 변경시켜주어야 합니다.

  

## Node JS 구성하기

package.json을 생성합니다.

```
npm init
```

```json
{
  "name": "docker-fullstack-app",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "4.17.1",
    "mysql": "2.16.0",
    "nodemon": "1.18.3",
    "body-parser": "1.19.0"
  },
  "author": "",
  "license": "ISC"
}

```

nodemon : 서버 코드 수정 시 재시작할 수 있게 해주는 모듈

body-parser : 클라이언트 요청의 본문을 해석해주는 모듈



server.js 입니다.

```javascript
const express = require("express");
const bodyParser = require("body-parser");

const db = require("./db");

const app = express();

// app.use(bodyParser.json());
app.use(express.urlencoded({ extended: true }));

app.use(express.json());

db.pool.query(`CREATE TABLE lists (
    id INTEGER AUTO_INCREMENT,
    value TEXT,
    PRIMARY KEY (id)
)`, (err, results, fields) => {
    console.log('results', results)
})

app.get('/api/values', function(req, res){
    db.pool.query('SELECT * FROM lists;',
        (err, results, fields) => {
            if (err) 
                return res.status(500).send(err)
            else 
                return res.json(results)
        })
})

app.post('/api/value', function(req, res, next){
    db.pool.query(`INSERT INTO lists (value) VALUES("${req.body.value}")`,
        (err, results, fields) => {
            if (err) 
                return res.status(500).send(err)
            else 
                return res.json({ success: true, value: req.body.value })
        })
})

app.listen(5000, ()=>{
    console.log("5000 포트에서 시작")
})

```



db.js 입니다.

```json
const mysql = require("mysql");
const pool = mysql.createPool({
    connectionLimit: 10,
    host: "mysql",
    user: "root",
    password: "",
    database: "myapp"
});
exports.pool = pool;
```





## React JS 구성하기



## 리액트 앱을 위한 도커 파일 만들기



## 노드 앱을 위한 도커 파일 만들기



